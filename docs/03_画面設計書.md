# 画面設計書

## 1. 概要

### 1.1 画面一覧

| No | 画面名 | URL | 説明 |
|----|--------|-----|------|
| 1 | ジョブ一覧 | /jobs | リサーチジョブの一覧表示 |
| 2 | 新規ジョブ作成 | /jobs/create | ASINを投入して新規ジョブを作成 |
| 3 | ジョブ詳細 | /jobs/{job_id} | ジョブの詳細情報と進捗表示 |
| 4 | 結果一覧 | /jobs/{job_id}/items | ジョブに紐づくアイテム一覧 |
| 5 | 商品詳細 | /items/{item_id} | 個別商品の詳細情報 |

### 1.2 技術スタック

- **テンプレートエンジン**: Jinja2
- **CSSフレームワーク**: Bootstrap 5.3
- **非同期通信**: htmx 1.9, fetch API
- **レスポンシブ**: Bootstrap グリッドシステム

---

## 2. 共通レイアウト

### 2.1 ヘッダー

```
┌────────────────────────────────────────────────────────────┐
│  物販リサーチ v1.0    [ジョブ一覧] [新規ジョブ]            │
└────────────────────────────────────────────────────────────┘
```

- **ロゴ**: クリックでトップページへ
- **ナビゲーション**:
  - ジョブ一覧: /jobs
  - 新規ジョブ: /jobs/create

### 2.2 フッター

```
┌────────────────────────────────────────────────────────────┐
│             © 2024 物販リサーチアプリ                       │
└────────────────────────────────────────────────────────────┘
```

---

## 3. 画面詳細

### 3.1 ジョブ一覧（/jobs）

#### ワイヤーフレーム

```
┌────────────────────────────────────────────────────────────┐
│ ジョブ一覧                              [新規ジョブ作成]   │
├────────────────────────────────────────────────────────────┤
│ ┌──────────────────────────────────────────────────────┐   │
│ │ ステータス | 作成日時    | 総数 | 成功 | 失敗 | 合格...│   │
│ ├──────────────────────────────────────────────────────┤   │
│ │ [完了]    | 2024-01-01 | 100  | 95   | 5    | 20 ...│   │
│ │ [処理中]  | 2024-01-02 | 50   | 30   | 2    | 8  ...│   │
│ │ [待機中]  | 2024-01-03 | 200  | 0    | 0    | 0  ...│   │
│ └──────────────────────────────────────────────────────┘   │
└────────────────────────────────────────────────────────────┘
```

#### 表示項目

| 項目 | 説明 | 表示形式 |
|------|------|----------|
| ステータス | ジョブの状態 | バッジ（色分け） |
| 作成日時 | ジョブ作成日時 | YYYY-MM-DD HH:MM |
| 総数 | 投入ASIN数 | 数値 |
| 成功 | 処理成功数 | 数値 |
| 失敗 | 処理失敗数 | 赤字（>0の場合） |
| 合格 | 判定合格数 | 緑太字（>0の場合） |
| 要確認 | 要確認数 | 黄字（>0の場合） |
| 操作 | アクションボタン | [詳細] [結果一覧] |

#### ステータスバッジ

| ステータス | 表示 | 色 |
|-----------|------|-----|
| DONE | 完了 | 緑 (bg-success) |
| RUNNING | 処理中 | 青 (bg-primary) |
| PENDING | 待機中 | グレー (bg-secondary) |
| FAILED | 失敗 | 赤 (bg-danger) |

---

### 3.2 新規ジョブ作成（/jobs/create）

#### ワイヤーフレーム

```
┌────────────────────────────────────────────────────────────┐
│ 新規リサーチジョブ作成                                      │
├────────────────────────────────────────────────────────────┤
│ ┌──────────────────────────────────────────────────────┐   │
│ │ ASINリスト（最大1000件）                               │   │
│ │ ┌──────────────────────────────────────────────────┐ │   │
│ │ │ B0XXXXXXXX                                       │ │   │
│ │ │ B0YYYYYYYY                                       │ │   │
│ │ │ ...                                              │ │   │
│ │ └──────────────────────────────────────────────────┘ │   │
│ │ 1行1ASIN、またはカンマ区切り。 [100] 件               │   │
│ │                                                       │   │
│ │ またはCSVファイルをアップロード                        │   │
│ │ [ファイルを選択]                                       │   │
│ └──────────────────────────────────────────────────────┘   │
│ ─────────────────────────────────────────────────────────  │
│ 判定基準                                                   │
│ ┌──────────────────────┬──────────────────────┐           │
│ │ 最低利益額（円）      │ 最低利益率（%）       │           │
│ │ [____1000____]       │ [____15______]       │           │
│ ├──────────────────────┼──────────────────────┤           │
│ │ ランキング上限（位）  │ 30日販売数（個以上）  │           │
│ │ [___50000____]       │ [____10______]       │           │
│ └──────────────────────┴──────────────────────┘           │
│ ─────────────────────────────────────────────────────────  │
│ ポイント設定                                               │
│ ┌──────────────────────┬──────────────────────┐           │
│ │ 通常ポイント率（%）   │ SPUポイント率（%）    │           │
│ │ [_____1______]       │ [_____7______]       │           │
│ └──────────────────────┴──────────────────────┘           │
│ ┌───────────────────────────────────────────────────┐     │
│ │ 合計ポイント率: 8%（v1.0固定想定）                  │     │
│ └───────────────────────────────────────────────────┘     │
│                                                            │
│           [ リサーチ開始 ]                                  │
└────────────────────────────────────────────────────────────┘
```

#### 入力項目

| 項目名 | フィールド名 | 型 | 初期値 | バリデーション |
|--------|-------------|-----|--------|----------------|
| ASINリスト | asins | textarea | - | 必須、最大1000件 |
| CSVファイル | csv-file | file | - | .csv, .txt |
| 最低利益額 | threshold_profit_amount | number | 1000 | ≥0 |
| 最低利益率 | threshold_profit_rate | number | 15 | 0-100 |
| ランキング上限 | threshold_rank | number | 50000 | ≥1 |
| 30日販売数 | threshold_sales_30 | number | 10 | ≥0 |
| 通常ポイント率 | point_rate_normal | number | 1 | 0-100 |
| SPUポイント率 | point_rate_spu | number | 7 | 0-100 |

#### JavaScript機能

1. **ASIN件数カウント**: 入力時にリアルタイムでユニーク件数を表示
2. **CSVファイル読み込み**: ファイル選択時にASINを抽出してテキストエリアに展開
3. **ポイント率合計**: 通常+SPUの合計を自動計算して表示

---

### 3.3 ジョブ詳細（/jobs/{job_id}）

#### ワイヤーフレーム

```
┌────────────────────────────────────────────────────────────┐
│ [← ジョブ一覧に戻る]                                        │
├──────────────────────────────────┬─────────────────────────┤
│ ジョブ詳細                [完了] │ 判定結果                 │
│ ─────────────────────────────── │ ─────────────────────── │
│ ジョブID: uuid-xxxx-xxxx        │       [20]     [5]       │
│ 作成日時: 2024-01-01 10:00:00   │       合格     要確認     │
│ 開始日時: 2024-01-01 10:00:05   │                          │
│ 完了日時: 2024-01-01 10:30:00   │ [ 結果一覧を見る ]        │
│                                 │ ─────────────────────── │
│ 進捗                            │ 判定基準                 │
│ ───────────────────────────    │ 利益額:      1,000円以上  │
│  [100]    [95]      [5]        │ 利益率:      15%以上      │
│   総数    成功      失敗        │ ランキング:  50,000位以内 │
│ ████████████████████░░░░ 95%   │ 30日販売数:  10個以上     │
│                                 │ ポイント率:  8.0%         │
│ [失敗分を再試行（5件）]           │                          │
└──────────────────────────────────┴─────────────────────────┘
```

#### 表示項目

| セクション | 項目 | 説明 |
|-----------|------|------|
| ジョブ詳細 | ジョブID | UUID形式 |
| | 作成日時 | YYYY-MM-DD HH:MM:SS |
| | 開始日時 | 処理開始時刻（あれば表示） |
| | 完了日時 | 処理完了時刻（あれば表示） |
| 進捗 | 総数/成功/失敗 | 大きな数字で表示 |
| | プログレスバー | 成功(緑)+失敗(赤) |
| | 再試行ボタン | 失敗>0かつDONE時のみ表示 |
| 判定結果 | 合格/要確認 | 大きな数字で表示 |
| | 結果一覧リンク | 結果一覧画面へ遷移 |
| 判定基準 | 各閾値 | ジョブ作成時の設定値 |

---

### 3.4 結果一覧（/jobs/{job_id}/items）

#### ワイヤーフレーム

```
┌────────────────────────────────────────────────────────────┐
│ [← ジョブ詳細に戻る]                                        │
├────────────────────────────────────────────────────────────┤
│ 結果一覧                                                   │
│ [全て(100)] [合格(20)] [要確認(5)] [不合格(75)]            │
├────────────────────────────────────────────────────────────┤
│ □ | ASIN       | 商品名    | 判定 | 販売 | 手数料 | ...   │
│ ──┼────────────┼──────────┼─────┼─────┼───────┼─────── │
│ □ | B0XXXXXXXX | 商品A... | [合格] | 5,000 | 1,000 | ...   │
│ ☑ | B0YYYYYYYY | 商品B... | [合格] | 6,000 | 1,200 | ...   │
│ □ | B0ZZZZZZZZ | 商品C... | [要確認] | 4,500 | 900 | ...   │
│ □ | B0AAAAAAAA | 商品D... | [不合格] | 3,000 | 600 | ...   │
└────────────────────────────────────────────────────────────┘
```

#### 表示項目

| 項目 | 説明 | 表示形式 |
|------|------|----------|
| 候補 | 仕入れ候補チェックボックス | チェックボックス |
| ASIN | Amazon ASIN | Amazonリンク付き |
| 商品名 | 商品タイトル | 省略表示（200px） |
| 判定 | PASS/REVIEW/FAIL | バッジ |
| 販売価格 | 最安FBA価格 | カンマ区切り |
| 手数料 | Amazon手数料合計 | カンマ区切り |
| 入金 | 入金価格 | カンマ区切り |
| 仕入 | 楽天実質仕入価格 | カンマ区切り |
| 利益額 | 利益額 | 緑太字（≥1000） |
| 利益率 | 利益率 | 緑字（≥15%） |
| ランク | 現在ランキング | カンマ区切り |
| 30日 | 30日販売数 | 数値 |
| 操作 | アクションボタン | [詳細] |

#### フィルタボタン

| フィルタ | クエリ | 説明 |
|---------|--------|------|
| 全て | ?pass_status= | 全件表示 |
| 合格 | ?pass_status=PASS | PASSのみ |
| 要確認 | ?pass_status=REVIEW | REVIEWのみ |
| 不合格 | ?pass_status=FAIL | FAILのみ |

#### 仕入れ候補チェック

- チェックボックス操作時にfetch APIで即時保存
- チェック行はハイライト表示（table-info）

---

### 3.5 商品詳細（/items/{item_id}）

#### ワイヤーフレーム

```
┌────────────────────────────────────────────────────────────┐
│ [← 結果一覧に戻る]                                          │
├──────────────────────────────────┬─────────────────────────┤
│ B0XXXXXXXX                [合格] │ 利益計算                 │
│ 商品タイトル                      │ ─────────────────────── │
│ ブランド: XXX | カテゴリ: YYY    │       2,500円            │
│                                  │       25.0%              │
│ ─────────────────────────────── │ ─────────────────────── │
│ Amazon販売情報   │ 楽天仕入情報  │ 仕入れ候補               │
│ ────────────── │ ────────── │ [✓] 仕入れ候補に追加     │
│ 販売価格 5,000円 │ 一致タイプ JAN │                          │
│ 販売手数料 500円 │ 商品価格 2,000円│ メモ                     │
│ FBA手数料  400円 │ 送料    [無料] │ ┌─────────────────┐    │
│ 手数料合計 900円 │ ポイント -200円 │ │                  │    │
│ 入金価格 4,100円 │ 実質仕入 1,800円│ └─────────────────┘    │
│                 │ [楽天で見る]   │ [ 保存 ]                 │
│ ─────────────────────────────── │ ─────────────────────── │
│ 売れ行き・セラー情報              │ リスクフラグ             │
│ ─────────────────────────────── │ 出品制限:   [OK]         │
│  [15,000]  [30]   [90]   [150]  │ 危険物:     [非該当]      │
│   ランク   30日   90日   180日   │ 大型商品:   [未確認]      │
│  [5]      [3]      [-]          │                          │
│ セラー数  FBA  最安FBA            │                          │
└──────────────────────────────────┴─────────────────────────┘
```

#### 表示セクション

**1. ヘッダー**
- ASIN（Amazonリンク付き）
- 判定バッジ（PASS/REVIEW/FAIL）
- 商品タイトル
- ブランド、カテゴリ

**2. Amazon販売情報**
| 項目 | 説明 |
|------|------|
| 販売価格（最安FBA） | amazon_price_fba_lowest |
| 販売手数料 | amazon_fee_referral |
| FBA手数料 | amazon_fee_fba |
| 手数料合計 | amazon_fee_total（赤字） |
| 入金価格 | amazon_payout |

**3. 楽天仕入情報**
| 項目 | 説明 |
|------|------|
| 一致タイプ | JAN/MODEL/NONE/UNKNOWN |
| 商品価格 | rakuten_price |
| 送料 | FREE/金額/不明 |
| ポイント還元 | rakuten_point（緑マイナス表示） |
| 実質仕入価格 | rakuten_cost_net |
| 楽天で見る | rakuten_item_url へリンク |

**4. 売れ行き・セラー情報**
| 項目 | 説明 |
|------|------|
| 現在ランキング | rank_current |
| 30/90/180日販売数 | sales_est_30/90/180 |
| セラー数 | seller_count |
| FBAセラー数 | fba_seller_count |
| 最安FBAセラー数 | fba_lowest_seller_count |

**5. 利益計算（右サイドバー）**
- 利益額（大きなフォント、緑色で強調）
- 利益率
- 利益額≥1000円の場合は緑枠でハイライト

**6. 仕入れ候補（右サイドバー）**
- チェックボックス（トグルスイッチ）
- メモテキストエリア
- 保存ボタン

**7. リスクフラグ（右サイドバー）**
| フラグ | 表示 |
|--------|------|
| 出品制限 | OK(緑)/制限あり(赤)/未確認(グレー) |
| 危険物 | 非該当(緑)/該当(赤)/未確認(グレー) |
| 大型商品 | 通常(緑)/大型(黄)/未確認(グレー) |

---

## 4. レスポンシブ対応

### 4.1 ブレークポイント

| サイズ | 幅 | 対応 |
|--------|-----|------|
| sm | <576px | モバイル |
| md | 576-768px | タブレット |
| lg | 768-992px | デスクトップ |
| xl | >992px | 大画面 |

### 4.2 レイアウト変更

- **ジョブ詳細**: lg以上で2カラム、未満で1カラム
- **商品詳細**: lg以上で8:4比率、未満で1カラム
- **テーブル**: table-responsiveでスクロール対応

---

## 5. カラーパレット

### 5.1 テーマカラー

| 用途 | クラス | カラー |
|------|--------|--------|
| 成功/合格/緑 | text-success, bg-success | #198754 |
| 警告/要確認/黄 | text-warning, bg-warning | #ffc107 |
| 危険/失敗/赤 | text-danger, bg-danger | #dc3545 |
| 情報/処理中/青 | text-primary, bg-primary | #0d6efd |
| 無効/待機/グレー | text-secondary, bg-secondary | #6c757d |
| ハイライト | table-info | #cff4fc |

---

## 6. 画面遷移図

```
                    ┌─────────────┐
                    │   トップ    │
                    │   (/)       │
                    └──────┬──────┘
                           │
                           ▼
                    ┌─────────────┐
                    │ ジョブ一覧   │◀─────────────────┐
                    │ (/jobs)     │                  │
                    └──────┬──────┘                  │
                           │                         │
              ┌────────────┴────────────┐            │
              │                         │            │
              ▼                         ▼            │
       ┌─────────────┐          ┌─────────────┐      │
       │ 新規作成     │          │ ジョブ詳細   │──────┤
       │(/jobs/create)│          │(/jobs/{id}) │      │
       └──────┬──────┘          └──────┬──────┘      │
              │                         │            │
              │（ジョブ作成後）          ▼            │
              │                  ┌─────────────┐     │
              └─────────────────▶│ 結果一覧    │─────┘
                                 │(/jobs/{id}/ │
                                 │   items)    │
                                 └──────┬──────┘
                                        │
                                        ▼
                                 ┌─────────────┐
                                 │ 商品詳細    │
                                 │(/items/{id})│
                                 └─────────────┘
```

---

## 7. APIエンドポイント連携

### 7.1 Web画面用

| 画面 | メソッド | URL | 説明 |
|------|---------|-----|------|
| ジョブ一覧 | GET | /jobs | 一覧表示 |
| 新規作成 | GET | /jobs/create | フォーム表示 |
| 新規作成 | POST | /jobs/create | ジョブ作成 |
| ジョブ詳細 | GET | /jobs/{id} | 詳細表示 |
| 再試行 | POST | /jobs/{id}/retry | 失敗分再試行 |
| 結果一覧 | GET | /jobs/{id}/items | 一覧表示 |
| 商品詳細 | GET | /items/{id} | 詳細表示 |

### 7.2 非同期API

| 操作 | メソッド | URL | 説明 |
|------|---------|-----|------|
| 候補更新 | PATCH | /api/items/{id}/candidate | 仕入れ候補トグル |

---

## 8. エラー表示

### 8.1 バリデーションエラー

- フォーム送信時にサーバーサイドでエラー検出
- Bootstrapのalert-dangerで表示

### 8.2 空データ

- 該当データなしの場合はalert-infoで案内表示
- 例: 「ジョブがありません。新規ジョブを作成してください。」
